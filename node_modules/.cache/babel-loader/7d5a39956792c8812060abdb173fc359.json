{"ast":null,"code":"import _toConsumableArray from\"/Users/arjun/Documents/Personal/Test/Theta/UI Theme/theta-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/arjun/Documents/Personal/Test/Theta/UI Theme/theta-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/arjun/Documents/Personal/Test/Theta/UI Theme/theta-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/arjun/Documents/Personal/Test/Theta/UI Theme/theta-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/arjun/Documents/Personal/Test/Theta/UI Theme/theta-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component,Fragment}from\"react\";import{withRouter}from\"react-router-dom\";import{connect}from\"react-redux\";import AppContext from\"app/appContext\";import GullLayout from\"app/GullLayout/GullLayout\";import{flatMap}from\"lodash\";var AuthGuard=/*#__PURE__*/function(_Component){_inherits(AuthGuard,_Component);var _super=_createSuper(AuthGuard);function AuthGuard(props,context){var _this;_classCallCheck(this,AuthGuard);_this=_super.call(this,props);var routes=context.routes;_this.state={authenticated:true,routes:routes};return _this;}_createClass(AuthGuard,[{key:\"componentDidMount\",value:function componentDidMount(){this.setState({routes:flatMap(this.state.routes,function(item){if(item.routes){return _toConsumableArray(item.routes);}return[item];})});if(!this.state.authenticated){this.redirectRoute(this.props);}}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){if(!this.state.authenticated){this.redirectRoute(this.props);}}},{key:\"shouldComponentUpdate\",value:function shouldComponentUpdate(nextProps,nextState){return nextState.authenticated!==this.state.authenticated;}},{key:\"redirectRoute\",value:function redirectRoute(props){var location=props.location,history=props.history;var pathname=location.pathname;history.push({pathname:\"/session/signin\",state:{redirectUrl:pathname}});}},{key:\"render\",value:function render(){var route=this.props.route;var authenticated=this.state.authenticated;return authenticated?/*#__PURE__*/React.createElement(Fragment,null,/*#__PURE__*/React.createElement(GullLayout,{route:route})):null;}}],[{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(props,state){var location=props.location,user=props.user;var pathname=location.pathname;var matched=state.routes.find(function(r){return r.path===pathname;});var authenticated=matched&&matched.auth&&matched.auth.length?matched.auth.includes(user.role):true;return{authenticated:authenticated};}}]);return AuthGuard;}(Component);AuthGuard.contextType=AppContext;var mapStateToProps=function mapStateToProps(state){return{user:state.user};};export default withRouter(connect(mapStateToProps)(AuthGuard));","map":{"version":3,"sources":["/Users/arjun/Documents/Personal/Test/Theta/UI Theme/theta-demo/src/app/auth/AuthGuard.jsx"],"names":["React","Component","Fragment","withRouter","connect","AppContext","GullLayout","flatMap","AuthGuard","props","context","routes","state","authenticated","setState","item","redirectRoute","nextProps","nextState","location","history","pathname","push","redirectUrl","route","user","matched","find","r","path","auth","length","includes","role","contextType","mapStateToProps"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport AppContext from \"app/appContext\";\nimport GullLayout from \"app/GullLayout/GullLayout\";\nimport { flatMap } from \"lodash\";\nclass AuthGuard extends Component {\n  constructor(props, context) {\n    super(props);\n    let { routes } = context;\n\n    this.state = {\n      authenticated: true,\n      routes\n    };\n  }\n\n  componentDidMount() {\n    this.setState({\n      routes: flatMap(this.state.routes, item => {\n        if (item.routes) {\n          return [...item.routes];\n        }\n        return [item];\n      })\n    });\n\n    if (!this.state.authenticated) {\n      this.redirectRoute(this.props);\n    }\n  }\n\n  componentDidUpdate() {\n    if (!this.state.authenticated) {\n      this.redirectRoute(this.props);\n    }\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    return nextState.authenticated !== this.state.authenticated;\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    const { location, user } = props;\n    const { pathname } = location;\n    const matched = state.routes.find(r => r.path === pathname);\n    const authenticated =\n      matched && matched.auth && matched.auth.length\n        ? matched.auth.includes(user.role)\n        : true;\n\n    return {\n      authenticated\n    };\n  }\n\n  redirectRoute(props) {\n    const { location, history } = props;\n    const { pathname } = location;\n\n    history.push({\n      pathname: \"/session/signin\",\n      state: { redirectUrl: pathname }\n    });\n  }\n\n  render() {\n    let { route } = this.props;\n    const { authenticated } = this.state;\n\n    return authenticated ? (\n      <Fragment>\n        <GullLayout route={route}></GullLayout>\n      </Fragment>\n    ) : null;\n  }\n}\n\nAuthGuard.contextType = AppContext;\n\nconst mapStateToProps = state => ({\n  user: state.user\n});\n\nexport default withRouter(connect(mapStateToProps)(AuthGuard));\n"]},"metadata":{},"sourceType":"module"}